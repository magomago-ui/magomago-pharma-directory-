<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MagoMago Pharma Directory</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Icon components
        const Search = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>;
        const Plus = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
        const Edit2 = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>;
        const Trash2 = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
        const X = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const Save = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path></svg>;
        const Check = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"></polyline></svg>;
        const AlertCircle = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line></svg>;
        const BookOpen = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>;
        const Users = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle></svg>;
        const Filter = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>;
        const Mail = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>;
        const History = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 3v5h5"></path><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"></path></svg>;
        const Shield = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>;

        // Storage API
        window.storage = {
            async get(key, shared = false) {
                const storageKey = shared ? `shared_${key}` : `user_${key}`;
                const value = localStorage.getItem(storageKey);
                return value ? { key, value, shared } : null;
            },
            async set(key, value, shared = false) {
                const storageKey = shared ? `shared_${key}` : `user_${key}`;
                localStorage.setItem(storageKey, value);
                return { key, value, shared };
            }
        };

        function App() {
            const [drugs, setDrugs] = useState([]);
            const [users, setUsers] = useState([]);
            const [currentUser, setCurrentUser] = useState(null);
            const [loginMode, setLoginMode] = useState(null);
            const [loading, setLoading] = useState(true);
            const [registrationData, setRegistrationData] = useState({nickname: '', email: '', medSchoolYear: '', code: ''});
            const [loginData, setLoginData] = useState({email: '', code: ''});

            useEffect(() => {
                loadData();
            }, []);

            const loadData = async () => {
                try {
                    const userResult = await window.storage.get('pharma-current-user');
                    const usersResult = await window.storage.get('pharma-users', true);
                    const drugsResult = await window.storage.get('pharma-drugs-approved', true);
                    
                    if (userResult?.value) setCurrentUser(JSON.parse(userResult.value));
                    if (usersResult?.value) setUsers(JSON.parse(usersResult.value));
                    if (drugsResult?.value) setDrugs(JSON.parse(drugsResult.value));
                } catch (error) {
                    console.log('Loading data...');
                }
                setLoading(false);
            };

            const handleRegister = async () => {
                if (!registrationData.nickname.trim() || !registrationData.email.trim() || !registrationData.code.trim()) {
                    alert('All fields required');
                    return;
                }
                if (registrationData.code.length !== 6) {
                    alert('Code must be 6 digits');
                    return;
                }
                
                const user = {
                    nickname: registrationData.nickname.trim(),
                    email: registrationData.email.trim().toLowerCase(),
                    medSchoolYear: registrationData.medSchoolYear,
                    code: registrationData.code,
                    registeredDate: new Date().toISOString()
                };

                const updatedUsers = [...users, user];
                await window.storage.set('pharma-users', JSON.stringify(updatedUsers), true);
                await window.storage.set('pharma-current-user', JSON.stringify(user));
                setUsers(updatedUsers);
                setCurrentUser(user);
            };

            const handleLogin = async () => {
                const user = users.find(u => u.email.toLowerCase() === loginData.email.toLowerCase() && u.code === loginData.code);
                if (!user) {
                    alert('Invalid credentials');
                    return;
                }
                await window.storage.set('pharma-current-user', JSON.stringify(user));
                setCurrentUser(user);
            };

            const handleLogout = async () => {
                await window.storage.set('pharma-current-user', '');
                setCurrentUser(null);
                setLoginMode(null);
            };

            if (loading) {
                return <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center"><div className="text-gray-600">Loading...</div></div>;
            }

            if (!currentUser) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-6">
                        <div className="bg-white rounded-lg shadow-lg p-8 max-w-md w-full">
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">MagoMago Pharma Directory</h1>
                            <p className="text-gray-600 mb-6">Welcome! Please select an option</p>
                            
                            {!loginMode && (
                                <div className="space-y-3">
                                    <button onClick={() => setLoginMode('register')} className="w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-medium">
                                        Register (First Time)
                                    </button>
                                    <button onClick={() => setLoginMode('login')} className="w-full bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 font-medium">
                                        Login (Returning User)
                                    </button>
                                </div>
                            )}

                            {loginMode === 'register' && (
                                <div className="space-y-4">
                                    <button onClick={() => setLoginMode(null)} className="text-sm text-blue-600 hover:underline mb-2">‚Üê Back</button>
                                    <input type="text" value={registrationData.nickname} onChange={(e) => setRegistrationData({...registrationData, nickname: e.target.value})} placeholder="Nickname *" className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="email" value={registrationData.email} onChange={(e) => setRegistrationData({...registrationData, email: e.target.value})} placeholder="Email *" className="w-full px-4 py-2 border rounded-lg" />
                                    <select value={registrationData.medSchoolYear} onChange={(e) => setRegistrationData({...registrationData, medSchoolYear: e.target.value})} className="w-full px-4 py-2 border rounded-lg">
                                        <option value="">Select Year *</option>
                                        <option value="MS1">MS1</option>
                                        <option value="MS2">MS2</option>
                                        <option value="MS3">MS3</option>
                                        <option value="MS4">MS4</option>
                                        <option value="Resident">Resident</option>
                                    </select>
                                    <input type="text" maxLength="6" value={registrationData.code} onChange={(e) => setRegistrationData({...registrationData, code: e.target.value.replace(/\D/g, '')})} placeholder="6-Digit Code *" className="w-full px-4 py-2 border rounded-lg" />
                                    <button onClick={handleRegister} className="w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-medium">Register</button>
                                </div>
                            )}

                            {loginMode === 'login' && (
                                <div className="space-y-4">
                                    <button onClick={() => setLoginMode(null)} className="text-sm text-blue-600 hover:underline mb-2">‚Üê Back</button>
                                    <input type="email" value={loginData.email} onChange={(e) => setLoginData({...loginData, email: e.target.value})} placeholder="Email" className="w-full px-4 py-2 border rounded-lg" />
                                    <input type="text" maxLength="6" value={loginData.code} onChange={(e) => setLoginData({...loginData, code: e.target.value.replace(/\D/g, '')})} placeholder="6-Digit Code" className="w-full px-4 py-2 border rounded-lg" />
                                    <button onClick={handleLogin} className="w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-medium">Login</button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">MagoMago Pharma Directory</h1>
                            <p className="text-gray-600">Collaborative drug reference with approval system</p>
                            <div className="mt-4 flex justify-between items-center">
                                <div>
                                    <p className="text-sm text-gray-600">
                                        <span className="font-semibold">{currentUser.nickname}</span> ({currentUser.medSchoolYear})
                                    </p>
                                </div>
                                <button onClick={handleLogout} className="text-sm text-blue-600 hover:text-blue-800">Logout</button>
                            </div>
                        </div>
                        
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h2 className="text-xl font-semibold mb-4">Approved Drugs ({drugs.length})</h2>
                            {drugs.length === 0 ? (
                                <p className="text-gray-500">No drugs yet. Full functionality loading...</p>
                            ) : (
                                <div className="space-y-4">
                                    {drugs.map(drug => (
                                        <div key={drug.id} className="border rounded-lg p-4">
                                            <h3 className="text-lg font-bold">{drug.name}</h3>
                                            <p className="text-sm text-gray-600">{drug.indications?.join(', ')}</p>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
